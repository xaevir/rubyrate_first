var tame = require('./tame').tame;
var __tame_fn_0 = function (__tame_k) {
    function call (i, ev) {
        var __tame_fn_5 = function (__tame_k) {
            console .log ( "+call " + i ) ;
            var __tame_fn_1 = function (__tame_k) {
                var __tame_fn_2 = function (__tame_k) {
                    var __tame_ev = new tame.Event (__tame_k);
                    var __tame_fn_3 = function (__tame_k) {
                        setTimeout ( __tame_ev.mkevent ( ) , 3000*Math.random ( ) ) ;
                        tame.callChain([__tame_k]);
                    };
                    __tame_fn_3(tame.end);
                    __tame_ev.trigger();
                };
                var __tame_fn_4 = function (__tame_k) {
                    console .log ( "-call " + i ) ;
                    ev ( ) ;
                    tame.callChain([__tame_k]);
                };
                tame.callChain([__tame_fn_2, __tame_fn_4, __tame_k]);
            };
            tame.callChain([__tame_fn_1, __tame_k]);
        };
        tame.callChain([__tame_fn_5, __tame_k]);
    }
    ;
    function window (n, window) {
        var __tame_fn_15 = function (__tame_k) {
            var rv = new tame .Rendezvous ( ) ;
            var nsent = 0 ;
            var nrecv = 0 ;
            var forlorn = 10 ;
            var __tame_fn_6 = function (__tame_k) {
                var __tame_fn_7 = function (__tame_k) {
                    if (nrecv < n) {
                        var __tame_fn_8 = function (__tame_k) {
                            var __tame_fn_9 = function (__tame_k) {
                                call ( nsent , rv .mkev ( nsent ) ) ;
                                nsent ++ ;
                                tame.callChain([__tame_k]);
                            };
                            var __tame_fn_14 = function (__tame_k) {
                                var res = [ ] ;
                                var __tame_fn_10 = function (__tame_k) {
                                    var __tame_fn_11 = function (__tame_k) {
                                        var __tame_ev = new tame.Event (__tame_k);
                                        var __tame_fn_12 = function (__tame_k) {
                                            rv .wait ( __tame_ev.mkevent ( res ) ) ;
                                            tame.callChain([__tame_k]);
                                        };
                                        __tame_fn_12(tame.end);
                                        __tame_ev.trigger();
                                    };
                                    var __tame_fn_13 = function (__tame_k) {
                                        console .log ( "got back id=" + res [ 0 ] ) ;
                                        nrecv ++ ;
                                        tame.callChain([__tame_k]);
                                    };
                                    tame.callChain([__tame_fn_11, __tame_fn_13, __tame_k]);
                                };
                                tame.callChain([__tame_fn_10, __tame_k]);
                            };
                            if (nsent - nrecv < window && nsent < n) {
                                tame.callChain([__tame_fn_9, __tame_k]);
                            } else {
                                tame.callChain([__tame_fn_14, __tame_k]);
                            }
                        };
                        tame.callChain([__tame_fn_8, __tame_fn_7, __tame_k]);
                    } else {
                        tame.callChain([__tame_k]);
                    }
                };
                tame.__k_global.k_break = __tame_k;
                tame.__k_global.k_continue = function() { __tame_fn_7(__tame_k); };
                tame.callChain([__tame_fn_7, __tame_k]);
            };
            tame.callChain([__tame_fn_6, __tame_k]);
        };
        tame.callChain([__tame_fn_15, __tame_k]);
    }
    ;
    
    window ( 100 , 10 ) ;
    tame.callChain([__tame_k]);
};
__tame_fn_0 (tame.end);